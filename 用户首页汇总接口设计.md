# 用户首页汇总接口设计

## 接口地址
`GET /user/summary`

## 功能说明
返回用户首页所需的所有汇总数据，包括用户信息、各模块统计数据等。

## 请求参数
无（通过 token 获取当前用户信息）

## 响应数据结构

```json
{
  "code": 0,
  "message": "success",
  "data": {
    // 用户信息
    "isAuth": true,
    "user": {
      "username": "用户名",
      "avatar": "头像URL"
    },
    
    // 目标模块
    "goals": {
      "statistics": {
        "total": 10,           // 总目标数
        "completed": 3,        // 已完成数
        "inProgress": 5,       // 进行中数
        "completion_rate": 30  // 完成率（百分比，0-100）
      },
      "list": [                // 目标列表（前5个）
        {
          "id": "goal_001",
          "name": "目标名称",
          "status": "in_progress",
          // ... 其他目标字段
        }
      ]
    },
    
    // 任务模块
    "tasks": {
      "todayCount": 5          // 今日任务数
    },
    
    // 读书打卡模块
    "reading": {
      "todayCheckIns": 2       // 今日打卡次数
    },
    
    // 错题本模块
    "errorbook": {
      "total": 50,             // 总错题数
      "today": 3               // 今日新增错题数
    },
    
    // 番茄专注模块（单位：分钟）
    "focus": {
      "today": 120,            // 今日专注时长（分钟）
      "month": 1800,           // 本月专注时长（分钟）
      "total": 10800           // 累计专注时长（分钟）
    },
    
    // 习惯打卡模块
    "habits": {
      "inProgress": 3          // 进行中的习惯数
    },
    
    // 生理期模块
    "period": {
      "status": "安全期",      // 状态：安全期/月经期/排卵期等
      "nextDays": 5            // 距离下次月经期的天数
    }
  }
}
```

## 字段说明

### 1. 用户信息
- `isAuth`: 是否已认证登录
- `user`: 用户信息（仅当 isAuth 为 true 时返回）
  - `username`: 用户名
  - `avatar`: 头像URL

### 2. 目标模块 (goals)
- `statistics`: 目标统计
  - `total`: 总目标数
  - `completed`: 已完成数
  - `inProgress`: 进行中数
  - `completion_rate`: 完成率（0-100）
- `list`: 目标列表（返回前5个，按创建时间倒序）

### 3. 任务模块 (tasks)
- `todayCount`: 今日任务数量

### 4. 读书打卡模块 (reading)
- `todayCheckIns`: 今日打卡次数

### 5. 错题本模块 (errorbook)
- `total`: 总错题数量
- `today`: 今日新增错题数量

### 6. 番茄专注模块 (focus)
- `today`: 今日专注时长（分钟）
- `month`: 本月专注时长（分钟）
- `total`: 累计专注时长（分钟）

### 7. 习惯打卡模块 (habits)
- `inProgress`: 进行中的习惯数量

### 8. 生理期模块 (period)
- `status`: 当前状态（如：安全期、月经期、排卵期等）
- `nextDays`: 距离下次月经期的天数

## 业务规则

1. **未登录用户**：`isAuth` 为 `false`，`user` 字段不返回，其他模块数据返回默认值（0或空数组）
2. **数据统计**：
   - 所有时间相关的统计以"今天"为基准（服务器时区）
   - 专注时长统一使用分钟作为单位
   - 完成率计算：`(completed / total) * 100`，四舍五入到整数
3. **列表数据**：
   - 目标列表只返回前5个，用于首页展示
   - 如需完整列表，调用对应的列表接口

## 错误处理

- 未登录：返回 `isAuth: false`，其他数据返回默认值
- 服务器错误：返回对应的错误码和错误信息

## 前端使用示例

```typescript
// 调用接口
const summary = await request.get('/user/summary');

// 更新页面数据
this.setData({
  isAuth: summary.isAuth,
  userInfo: summary.user ? {
    username: summary.user.username,
    avatar: summary.user.avatar
  } : {},
  goals: summary.goals.list || [],
  statistics: summary.goals.statistics,
  'modules.tasks.todayCount': summary.tasks.todayCount,
  'modules.reading.todayCheckIns': summary.reading.todayCheckIns,
  'modules.errorbook.total': summary.errorbook.total,
  'modules.errorbook.today': summary.errorbook.today,
  'modules.focus.today': summary.focus.today,
  'modules.focus.month': summary.focus.month,
  'modules.focus.total': summary.focus.total,
  'modules.habits.inProgress': summary.habits.inProgress,
  'modules.period.status': summary.period.status,
  'modules.period.nextDays': summary.period.nextDays
});
```

